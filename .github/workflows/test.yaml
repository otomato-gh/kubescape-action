name: Test
on:
  workflow_dispatch:
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Prepare file to scan
        run: |
          curl -O https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.2.0/deploy/static/provider/cloud/deploy.yaml
      - name: Scan files 
        uses: otomato-gh/kubescape-action@main
        with:
          ksversion: 'v2.0.155'
          format: 'json'
          path: 'deploy.yaml'
      - name: Observe Runner Directory
        if: always()
        run: ls -a .
      #- name: Retrieve Scan Results
      #  if: always() 
      #  uses: actions/upload-artifact@v1
      #  with:
      #   name: scan-results
      #   path: |
      #     results.json
      #     results.xml
      #     results.pdf
      - name: Setup Python (for the next step)
        uses: actions/setup-python@v3
        if: always() 
        with:
           python-version: 3.8
      - name: Retrieve Scan Results
        uses: EnricoMi/publish-unit-test-result-action/composite@v1
        if: always()
        with:
          check_name: "Kubescape: Saved Scan Results"
          ignore_runs: true
          check_run_annotations: none
          pull_request_build: commit
          files: "results.*"
           
          
