name: Test
on:
  workflow_dispatch:
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Prepare file to scan
        run: |
          curl -O https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.2.0/deploy/static/provider/cloud/deploy.yaml
      - name: Scan files 
        uses: otomato-gh/kubescape-action@main
        with:
          ksversion: 'v2.0.155'
          format: 'json'
          path: 'deploy.yaml'
      - name: Observe Runner Directory
        if: always()
        run: ls -a .
      #- name: Retrieve Scan Results
      #  if: always() 
      #  uses: actions/upload-artifact@v1
      #  with:
      #   name: scan-results
      #   path: |
      #     results.json
      #     results.xml
      #     results.pdf
      #- name: Setup Python
      #  uses: actions/setup-python@v3
      #  if: always() 
      #  with:
      #     python-version: 3.8
      - name: Save results in a new branch
        uses: sylvanld/action-storage@v1
        if: always()
        with:
          storage-branch: scan-results
          src: results.json
          dst: results.json
          
          
          
